<!DOCTYPE html>
<html>
<head>
    <title>Introducing the Grails® 3 GORM Logical Delete Plugin</title>
    <meta name="keywords" content="grails,jvm,framework,groovy,gradle,spring-boot,gorm"/>
    <meta name="description" content="A blog explaining the usage and under the hood details of the Grails® 3 GORM Logical Delete Plugin."/>
    <meta name="date" content="April 5, 2018"/>
    <meta name="robots" content="all"/>
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://grails.staged.apache.org/rss.xml"/>
    <meta charset='UTF-8'/>
    <link rel='icon' href='https://grails.staged.apache.org/images/favicon.ico'/>
    <meta name='twitter:card' content='summary_large_image'/>
    <meta name='twitter:site' content='@grailsframework'/>
    <meta name='twitter:description' content='A blog explaining the usage and under the hood details of the Grails® 3 GORM Logical Delete Plugin.'/>
    <meta name='twitter:creator' content='@grailsframework'/>
    <meta property='og:image' content='https://grails.staged.apache.org/images/grails.png'/>
    <meta property='og:image:width' content='300'/>
    <meta property='og:image:height' content='300'/>
    <meta property='og:url' content='https://grails.staged.apache.org'/>
    <meta property='og:title' content='Introducing the Grails® 3 GORM Logical Delete Plugin'/>
    <meta property='og:description' content='A blog explaining the usage and under the hood details of the Grails® 3 GORM Logical Delete Plugin.'/>
    <meta property='og:type' content='website'/>

    <meta name='viewport' content='width=device-width, initial-scale=1'/>
    <link rel='mask-icon' href='https://grails.staged.apache.org/images/grails-pinned-icon.svg' color='feb672'/>
    <link rel='stylesheet' href='https://grails.staged.apache.org/stylesheets/screen.css'/>
    <link rel='stylesheet' href='https://grails.staged.apache.org/stylesheets/plugin.css'/>
    <link rel='stylesheet' href='https://grails.staged.apache.org/stylesheets/paginate.css'/>
    <script src='https://grails.staged.apache.org/javascripts/navigation.js'></script>
    <script src='https://grails.staged.apache.org/javascripts/paginate.js'></script>
    
    <link rel='stylesheet' href='https://grails.staged.apache.orghttps://grails.staged.apache.org/stylesheets/prism.css'/>
    <script src='https://grails.staged.apache.org/javascripts/prism.js'></script>
    <script src='https://grails.staged.apache.org/javascripts/plugins.js'></script>
</head>
<body>
<header class='mainheader'>
    <div class='content'>
        <a href='https://grails.staged.apache.org/index.html'><img class='grailslogo' src='https://grails.staged.apache.org/images/grails_logo.svg' alt='Grails Logo'/></a>
        <a href='javascript:show(&apos;topmenus&apos;, &apos;showNavigationLink&apos;)' id='showNavigationLink'
           class='mobile align-center'>Show Navigation</a>
        <div id='topmenus'>
            <nav class='secondarymenu' id='secondarymenu'>
                <ul>
                    <li><a href='https://grails.staged.apache.org/casestudies/index.html'>Case Studies</a></li>
                    <li><a href='https://grails.staged.apache.org/blog/index.html'>Blog</a></li>
                    <li><a href='https://grails.staged.apache.org/learning.html'>Learning</a></li>
                    <li><a href='https://grails.staged.apache.org/community.html'>Community</a></li>
                    <li><a href='https://grails.staged.apache.org/search.html'>Search</a></li>
                </ul>
            </nav>
            <nav class='mainmenu' id='mainmenu'>
                <ul>
                    <li><a href='https://grails.staged.apache.org/documentation.html'>Documentation</a></li>
                    <li><a href='https://grails.staged.apache.org/download.html'>Download</a></li>
                    <li><a href='https://grails.staged.apache.org/plugins.html'>Plugins</a></li>
                    <li><a href='https://guides.grails.org/index.html'>Guides</a></li>
                    <li><a href='https://grails.staged.apache.org/faq.html'>FAQ</a></li>
                    <li><a href='https://grails.staged.apache.org/support.html'>Support</a></li>
                    <li><a href='https://start.grails.org'>Forge App</a></li>
                </ul>
            </nav>
        </div>
    </div>
</header>
<article><div class='headerbar chalicesbg'>
  <div class='content'>
    <h1>
      <a href='https://grails.staged.apache.org/blog/index.html'>Grails Blog</a>
    </h1>
  </div>
</div>
<div class='content container'>
  <div class='light padded blogpost'><h1>Introducing the Grails® 3 GORM Logical Delete Plugin</h1>
<p><span class="author">By Nirav Assar</span></p>
<p><span class="date">April 5, 2018</span></p>
<p>Tags: <a href="https://grails.staged.apache.org/blog/tag/gorm.html"><span class="hashtag">#gorm</span></a> <a href="https://grails.staged.apache.org/blog/tag/plugins.html"><span class="hashtag">#plugins</span></a></p>
<p>Recently our development team came upon the need to develop a Grails<sup>®</sup> 3 plugin that implements logical delete for entities.</p>
<p>A &quot;logical&quot; delete (sometimes referred to as a &quot;soft&quot; delete) is a delete that doesn’t actually delete the relevant data but instead marks the data as deleted. Marking the data as deleted has the benefit of excluding the data from queries by default, while still maintaining the ability to retrieve the data when/if necessary. Essentially the plugin offers a mechanism to &quot;hide&quot; domain objects from retrieval. This is useful for retaining data without having it clutter the current set of active data.</p>
<p>Logical Delete functionality is available in a few Grails 2 plugins. However these implementations rely on filters, ASTs, and runtime metaClass enhancements. We decided to create another implementation of the logical delete using some of latest Grails 3 features such as Traits and Listeners.</p>
<p>This blog will highlight how to use the plugin and also give some insight into the techniques used under the covers.</p>
<hr />
<h2>Summary</h2>
<p><a href="https://grails-plugins.github.io/gorm-logical-delete/">GORM Logical Delete Plugin</a></p>
<p>Logical delete of an entity has a few relevant use cases in enterprise applications. Companies may want to &quot;delete&quot; data from their everyday usage, but still keep it for later retrieval. Auditing requirements for financial institutions may require the data to be sustained for up to seven years.</p>
<p>From a technical perspective, if a domain model has several complex associations that make a chain of domain objects, hard deletion may cause slow cascading affects or be blocked by referential integrity. In these situations, a logical delete alleviates these concerns.</p>
<h2>Installation</h2>
<p>To add the GORM Logical Delete plugin to an application, add the following dependency to the dependencies block of your <code>build.gradle</code>:</p>
<pre><code class="language-groovy">compile &quot;org.grails.plugins:gorm-logical-delete:2.0.0.M2&quot;
</code></pre>
<h2>Enable Domain Entity with Logical Delete</h2>
<p>Any domain entity can be implemented with the <code>LogicalDelete</code> trait. The trait adds a boolean persistent property named <code>deleted</code> to the domain class. The property is used to &quot;hide&quot; entities from queries if it is set to <code>true</code>. Note the mapping columns can customize the property to a database column name.</p>
<pre><code class="language-groovy">import gorm.logical.delete.LogicalDelete

class Person implements LogicalDelete&lt;Person&gt; {
    String userName

    static mapping = {
        // the deleted property may be configured
        // like any other persistent property...
        deleted column:&quot;delFlag&quot;
    }
}
</code></pre>
<p>In order to delete a domain object enabled with logical delete, simply use the same GORM interface as usual.</p>
<pre><code class="language-groovy">Person p = new Person(userName: &quot;Nirav&quot;).save()
p.delete()
</code></pre>
<p>If you would like to physically delete the record from persistence, use the attribute <code>hard: true</code>:</p>
<pre><code class="language-groovy">p.delete(hard: true)
</code></pre>
<p>Undelete functionality is quite handy if you want to reverse the property to false.</p>
<pre><code class="language-groovy">Person.withDeleted {
    Person p = Person.get(id)
    p?.unDelete()
}
</code></pre>
<h2>Querying Objects</h2>
<p>When an object is enabled with logical delete, queries associated with the domain object will hide those marked with <code>deleted = true</code>.</p>
<p>Dynamic Finders, Criteria Query, Detached Criteria Query, and the <code>GormEntity</code> methods like <code>get</code>, <code>load</code>, <code>proxy</code>, and <code>read</code> are all supported.</p>
<p>See the <a href="https://grails-plugins.github.io/gorm-logical-delete/snapshot/index.html#_queries">Query documentation</a> for a list of examples.</p>
<blockquote>
<p>Note Hibernate Criteria and HQL queries are NOT supported by this plugin as they are ORM implementation specific.</p>
</blockquote>
<h2>Behind The Scenes</h2>
<p>It's beneficial to understand how the plugin is implemented under the covers. We have tried to use the most efficient techniques with Groovy and the Grails framework, which reduces some of the noise and clutter found in previous plugin implementations.</p>
<p>In concept, what is occurring is that any domain object can be given a logical delete capability with the attribute <code>deleted</code>. When the entity is logically deleted, it is set to <code>true</code>. It is not physically deleted from persistence. During query time, a query event is intercepted by a listener and the query is altered to only include <code>deleted = false</code> items from the result set. This gives the illusion that the items are not present, but in reality they are just hidden by the query.</p>
<h2>LogicalDelete</h2>
<p>The <a href="https://grails-plugins.github.io/gorm-logical-delete/snapshot/api/gorm/logical/delete/LogicalDelete.html"><code>LogicalDelete</code></a> trait makes available a <code>deleted</code> attribute. As stated earlier, an entity can implement this.</p>
<p>The <code>LogicalDelete</code> trait has overridden static methods which take into account the <code>deleted</code> property in an altered query. This allows the client to use the <code>GormEntity</code> methods to essentially hide those items.</p>
<h2>PreQueryListener</h2>
<p>The <a href="https://grails-plugins.github.io/gorm-logical-delete/snapshot/api/gorm/logical/delete/PreQueryListener.html"><code>PreQueryListener</code></a> implements <code>ApplicationListener</code> and when the event fires, it will add a <code>deleted</code> equals <code>false</code> to the query.</p>
<p>The <code>ThreadLocal</code> variable <code>IGNORE_DELETED_FILTER</code> should also be noted. When set to <code>true</code>, then all entities that exist in the database are included in the query. In other words, it bypasses the logical delete flag all together. In <code>LogicalDelete</code>, note how this <code>ThreadLocal</code> variable is used in the <code>withDeleted</code> method. The method is passed in a closure (which is a query) and the variable is set to <code>true</code>, which bypasses the delete flag.</p>
<p><a href="https://grails-plugins.github.io/gorm-logical-delete/snapshot/api/org/gorm/logical/delete/ast/WithDeletedTransformation.html"><code>WithDeletedTransformation</code></a> essentially achieves the same goal, but is intended as an implementation for an annotation.</p>
<p>The spock tests contained in the plugin are a good resource to reference examples and usages of the plugin API.</p>
<p>Take a look and we hope the plugin is useful for your needs.</p>
    <h2 class='space-above'>
      <span>You might also like ...</span>
    </h2>
    <div class='threecolumns'>
      <div class='column'><article class='blogcard' style='background-image: url(https://grails.staged.apache.org/images/2018-10-02.jpg)'>
  <a href='https://grails.staged.apache.org/blog/2018-10-02.html'>
    <h3>October 2, 2018</h3>
    <h2>Grails® Domain Read-Only Attribute</h2>
  </a>
</article></div>
      <div class='column'><article class='blogcard' style='background-image: url(https://grails.staged.apache.org/images/2018-03-09.jpg)'>
  <a href='https://grails.staged.apache.org/blog/2018-03-09.html'>
    <h3>March 9, 2018</h3>
    <h2>Webinar: Build a Better API with GORM &amp; Graph...</h2>
  </a>
</article></div>
      <div class='column'><article class='blogcard' style='background-image: url(https://grails.staged.apache.org/images/2017-06-27.jpg)'>
  <a href='https://grails.staged.apache.org/blog/2017-06-27.html'>
    <h3>June 27, 2017</h3>
    <h2>Checked Exceptions Rollback Transactions Sinc...</h2>
  </a>
</article></div>
    </div>
  </div>
</div>&nbsp;</article>
<footer>
    <div class='content'>
        <div class='apache-grails'>
            <p>The Apache Grails Framework is incubating at the Apache Software Foundation, sponsored by the <a href="http://groovy.apache.org" target="_blank">Apache
                Groovy</a> project. It is supported by the Grails community.</p>
            <a href='https://apache.org'><img class='' src='https://grails.staged.apache.org/images/asf_logo.svg' width='300px'
                                              alt='Apache Software Foundation'/></a>
            <p>The Apache Software Foundation</p>
            <p>Apache, Apache Grails, Grails, and the Apache feather logo are either registered trademarks or trademarks
                of The Apache Software Foundation.
            </p>

        </div>
        <nav class='socialmedianav'>
            <ul>
                <li>
                    <a href='mailto:dev@grails.apache.org'><img class='' src='https://grails.staged.apache.org/images/email.svg' alt='Email Icon'/></a>
                </li>
                <li>
                    <a href='https://slack.grails.org'><img class='' src='https://grails.staged.apache.org/images/slack.svg'
                                                            alt='Slack Icon'/></a>
                </li>
                <li>
                    <a hre f='https://www.youtube.com/@GrailsFramework'><img class='' src='https://grails.staged.apache.org/images/youtube.svg'
                                                                             alt='Youtube Icon'/></a>
                </li>
                <li>
                    <a href='https://www.linkedin.com/showcase/official-grails/'><img class=''
                                                                                      src='https://grails.staged.apache.org/images/linkedin.svg'
                                                                                      alt='LinkedIn Icon'/></a>
                </li>
                <li>
                    <a href='https://github.com/apache/grails-core'><img class='' src='https://grails.staged.apache.org/images/github.svg'
                                                              alt='Github Icon'/></a>
                </li>
                <li style="margin-bottom:10px;">
                    <a href='https://twitter.com/grailsframework'><img class='' src='https://grails.staged.apache.org/images/x-twitter.svg'
                                                                       alt='Twitter Icon'/></a>
                </li>
            </ul>
        </nav>
    </div>
    <div class="content">
        <nav class='footer' style="margin-bottom: 10px">
                <p>© 2005-2025 the Apache Grails project — Grails is Open Source: 
                    <a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache 2 License</a>, 
                    <a href='https://privacy.apache.org/policies/privacy-policy-public.html'>Privacy Policy</a>
                </p>
        </nav>
    </div>
</footer>
<div>

</div>
</body>
</html>
